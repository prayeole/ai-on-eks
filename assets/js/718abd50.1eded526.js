"use strict";(self.webpackChunkdoeks_website=self.webpackChunkdoeks_website||[]).push([[7043],{26384:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"guidance/benchmarking/test-scenarios/saturation-testing","title":"SCENARIO 2: Saturation Testing","description":"When to use this scenario:","source":"@site/docs/guidance/benchmarking/4-test-scenarios/2-saturation-testing.md","sourceDirName":"guidance/benchmarking/4-test-scenarios","slug":"/guidance/benchmarking/test-scenarios/saturation-testing","permalink":"/ai-on-eks/docs/guidance/benchmarking/test-scenarios/saturation-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/awslabs/ai-on-eks/blob/main/website/docs/guidance/benchmarking/4-test-scenarios/2-saturation-testing.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"Scenario 2 - Saturation Testing"},"sidebar":"guidance","previous":{"title":"Scenario 1 - Baseline Performance","permalink":"/ai-on-eks/docs/guidance/benchmarking/test-scenarios/baseline-performance"},"next":{"title":"Scenario 3 - Automatic Saturation Detection","permalink":"/ai-on-eks/docs/guidance/benchmarking/test-scenarios/automatic-saturation-detection"}}');var i=t(74848),s=t(28453);const r={sidebar_label:"Scenario 2 - Saturation Testing"},o="SCENARIO 2: Saturation Testing",c={},l=[{value:"When to use this scenario:",id:"when-to-use-this-scenario",level:2},{value:"Deployment",id:"deployment",level:2},{value:"Using Helm Chart (Recommended)",id:"using-helm-chart-recommended",level:3},{value:"Customizing Load Stages",id:"customizing-load-stages",level:3},{value:"Key Configuration:",id:"key-configuration",level:2},{value:"Understanding the results:",id:"understanding-the-results",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"scenario-2-saturation-testing",children:"SCENARIO 2: Saturation Testing"})}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use-this-scenario",children:"When to use this scenario:"}),"\n",(0,i.jsx)(n.p,{children:"Use multi-stage saturation testing when you need to empirically determine your system's maximum sustainable throughput before performance degrades. This is critical before production launch, when planning capacity, or setting autoscaling thresholds, as it answers \"what's the highest QPS we can reliably handle?\" Through systematic load increases, you'll observe where latency starts climbing or errors appear, revealing your true capacity ceiling that marketing materials and theoretical calculations often overestimate."}),"\n",(0,i.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,i.jsx)(n.h3,{id:"using-helm-chart-recommended",children:"Using Helm Chart (Recommended)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Add the AI on EKS Helm repository\nhelm repo add ai-on-eks https://awslabs.github.io/ai-on-eks-charts/\nhelm repo update\n\n# Install saturation scenario\nhelm install saturation-test ai-on-eks/benchmark-charts \\\n  --set benchmark.scenario=saturation \\\n  --set benchmark.target.baseUrl=http://qwen3-vllm.default:8000 \\\n  --set benchmark.target.modelName=qwen3-8b \\\n  --set benchmark.target.tokenizerPath=Qwen/Qwen3-8B \\\n  --namespace benchmarking --create-namespace\n\n# Monitor progress through multiple stages\nkubectl logs -n benchmarking -l benchmark.scenario=saturation -f\n"})}),"\n",(0,i.jsx)(n.h3,{id:"customizing-load-stages",children:"Customizing Load Stages"}),"\n",(0,i.jsx)(n.p,{children:"Adjust the QPS stages to match your expected capacity:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# custom-saturation.yaml\nbenchmark:\n  scenario: saturation\n  target:\n    baseUrl: http://your-model.your-namespace:8000\n  scenarios:\n    saturation:\n      load:\n        stages:\n          - rate: 10\n            duration: 180\n          - rate: 25\n            duration: 180\n          - rate: 50\n            duration: 180\n          - rate: 75\n            duration: 180\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm install saturation-test ai-on-eks/benchmark-charts -f custom-saturation.yaml -n benchmarking\n"})}),"\n",(0,i.jsx)(n.h2,{id:"key-configuration",children:"Key Configuration:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Variable synthetic data distributions (mean 512/256 tokens, realistic variance)"}),"\n",(0,i.jsx)(n.li,{children:"Multi-stage constant load: 5 \u2192 10 \u2192 20 \u2192 40 QPS (3 minutes each)"}),"\n",(0,i.jsx)(n.li,{children:"Streaming enabled"}),"\n",(0,i.jsx)(n.li,{children:"8 concurrent workers"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"understanding-the-results",children:"Understanding the results:"}),"\n",(0,i.jsx)(n.p,{children:'Plot P50, P95, and P99 latency across all stages to visually identify the saturation point\u2014look for the stage where percentiles diverge sharply or error rates spike. The "knee" in your latency curve (where it hockey-sticks upward) indicates your practical capacity limit, not the theoretical maximum QPS your system handled. Set production targets 20-30% below this saturation point to maintain headroom for traffic spikes; if saturation occurs at 35 QPS, target 24-28 QPS sustained load. Compare different model configurations or hardware setups using identical test stages to make objective scaling decisions backed by data rather than vendor claims.'}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("strong",{children:"Alternative: Raw Kubernetes YAML"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: inference-perf-saturation\n  namespace: benchmarking\ndata:\n  config.yml: |\n    api:\n      type: completion\n      streaming: true\n\n    data:\n      type: synthetic\n      input_distribution:\n        mean: 512\n        std_dev: 128\n        min: 128\n        max: 2048\n      output_distribution:\n        mean: 256\n        std_dev: 64\n        min: 32\n        max: 512\n\n    load:\n      type: constant\n      stages:\n        - rate: 5\n          duration: 180\n        - rate: 10\n          duration: 180\n        - rate: 20\n          duration: 180\n        - rate: 40\n          duration: 180\n      num_workers: 8\n\n    server:\n      type: vllm\n      model_name: qwen3-8b\n      base_url: http://qwen3-vllm.default:8000\n      ignore_eos: true\n\n    tokenizer:\n      pretrained_model_name_or_path: Qwen/Qwen3-8B\n\n    storage:\n      simple_storage_service:\n        bucket_name: "inference-perf-results"\n        path: "saturation-test/results"\n---\napiVersion: batch/v1\nkind: Job\nmetadata:\n  name: inference-perf-saturation\n  namespace: benchmarking\nspec:\n  backoffLimit: 2\n  ttlSecondsAfterFinished: 3600\n  template:\n    spec:\n      restartPolicy: Never\n      serviceAccountName: inference-perf-sa\n\n      affinity:\n        podAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n          - labelSelector:\n              matchLabels:\n                app.kubernetes.io/component: qwen3-vllm\n            topologyKey: topology.kubernetes.io/zone\n\n      containers:\n      - name: inference-perf\n        image: quay.io/inference-perf/inference-perf:v0.2.0\n        command: ["/bin/sh", "-c"]\n        args:\n        - |\n          inference-perf --config_file /workspace/config.yml\n        volumeMounts:\n        - name: config\n          mountPath: /workspace/config.yml\n          subPath: config.yml\n        resources:\n          requests:\n            cpu: "2"\n            memory: "4Gi"\n          limits:\n            cpu: "4"\n            memory: "8Gi"\n\n      volumes:\n      - name: config\n        configMap:\n          name: inference-perf-saturation\n'})})]})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var a=t(96540);const i={},s=a.createContext(i);function r(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);