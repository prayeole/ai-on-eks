"use strict";(self.webpackChunkdoeks_website=self.webpackChunkdoeks_website||[]).push([[977],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var i=s(96540);const t={},a=i.createContext(t);function r(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},42450:(e,n,s)=>{s.d(n,{A:()=>g});var i=s(96540),t=s(5556),a=s.n(t),r=s(34164);const o="collapsibleContent_q3kw",l="header_QCEw",c="icon_PckA",d="content_qLC1",h="expanded_iGsi";var u=s(74848);function p({children:e,header:n}){const[s,t]=(0,i.useState)(!1);return(0,u.jsxs)("div",{className:o,children:[(0,u.jsxs)("div",{className:(0,r.A)(l,{[h]:s}),onClick:()=>{t(!s)},children:[n,(0,u.jsx)("span",{className:(0,r.A)(c,{[h]:s}),children:s?"\ud83d\udc47":"\ud83d\udc48"})]}),s&&(0,u.jsx)("div",{className:d,children:e})]})}p.propTypes={children:a().node.isRequired,header:a().node.isRequired};const g=p},55210:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/envoy-d16d11704bf5bb704c9d0413c8acb583.png"},67953:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"blueprints/gateways/envoy-gateway","title":"Envoy gateway","description":"Organizations deploying AI applications face a fundamental challenge: no single model serves all needs. Developers may choose Claude for long-context analysis, OpenAI for reasoning tasks, and DeepSeek for cost-sensitive workloads. The problem is that each model provider uses different APIs. Without centralized control, teams can\'t easily switch providers, get visibility into utilization, or enforce quotas.","source":"@site/docs/blueprints/gateways/envoy-gateway.md","sourceDirName":"blueprints/gateways","slug":"/blueprints/gateways/envoy-gateway","permalink":"/ai-on-eks/docs/blueprints/gateways/envoy-gateway","draft":false,"unlisted":false,"editUrl":"https://github.com/awslabs/ai-on-eks/blob/main/website/docs/blueprints/gateways/envoy-gateway.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"Envoy Gateway implementation on EKS"},"sidebar":"blueprints","previous":{"title":"Inference Charts","permalink":"/ai-on-eks/docs/blueprints/inference/inference-charts"}}');var t=s(74848),a=s(28453),r=s(42450);const o={sidebar_label:"Envoy Gateway implementation on EKS"},l="Envoy gateway",c={},d=[{value:"Key objectives of Envoy AI Gateway",id:"key-objectives-of-envoy-ai-gateway",level:2},{value:"Envoy Gateway Fundamentals",id:"envoy-gateway-fundamentals",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Deploy",id:"deploy",level:3},{value:"Verify the resources",id:"verify-the-resources",level:3},{value:"Deploying self-hosted models",id:"deploying-self-hosted-models",level:2},{value:"1. Create Hugging Face Token Secret",id:"1-create-hugging-face-token-secret",level:3},{value:"2. Deploy Pre-configured Models",id:"2-deploy-pre-configured-models",level:3},{value:"Enabling access to AWS Bedrock models",id:"enabling-access-to-aws-bedrock-models",level:3},{value:"Multi-model routing",id:"multi-model-routing",level:2},{value:"Deploy common gateway infrastructure",id:"deploy-common-gateway-infrastructure",level:3},{value:"Configure model backends",id:"configure-model-backends",level:3},{value:"Configure model routes",id:"configure-model-routes",level:3},{value:"Test",id:"test",level:2},{value:"Rate limiting",id:"rate-limiting",level:2},{value:"Configure rate limiting",id:"configure-rate-limiting",level:3},{value:"Test rate limiting",id:"test-rate-limiting",level:3},{value:"Configuration Details",id:"configuration-details",level:2},{value:"Routing Configuration",id:"routing-configuration",level:3},{value:"Bedrock Integration Details",id:"bedrock-integration-details",level:3},{value:"Resources",id:"resources",level:2},{value:"Important Notes",id:"important-notes",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"envoy-gateway",children:"Envoy gateway"})}),"\n",(0,t.jsx)(n.p,{children:"Organizations deploying AI applications face a fundamental challenge: no single model serves all needs. Developers may choose Claude for long-context analysis, OpenAI for reasoning tasks, and DeepSeek for cost-sensitive workloads. The problem is that each model provider uses different APIs. Without centralized control, teams can't easily switch providers, get visibility into utilization, or enforce quotas."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://aigateway.envoyproxy.io/",children:"Envoy AI Gateway"})," is an open source project that solves this challenge by providing a single, scalable OpenAI-compatible endpoint that routes to multiple supported LLM providers. It gives Platform teams cost controls and observability, while developers never touch provider-specific SDKs."]}),"\n",(0,t.jsx)(n.h2,{id:"key-objectives-of-envoy-ai-gateway",children:"Key objectives of Envoy AI Gateway"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Provide a unified layer for routing and managing LLM/AI traffic"}),"\n",(0,t.jsx)(n.li,{children:"Support automative failover mechanisms to ensure service reliability"}),"\n",(0,t.jsx)(n.li,{children:"Ensure end-to-end security, including upstream authorization for LLM/AI traffic"}),"\n",(0,t.jsx)(n.li,{children:"Implement a policy framework to support usage limiting use cases"}),"\n",(0,t.jsx)(n.li,{children:"Foster an open-source community to address GenAI-specific routing and quality of service needs"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"envoy-gateway-fundamentals",children:"Envoy Gateway Fundamentals"}),"\n",(0,t.jsx)(n.admonition,{title:"If you're already familiar with Envoy Gateway, you can skip this section.",type:"info"}),"\n",(0,t.jsx)(n.p,{children:"As Envoy AI Gateway builds on top of the standard Kubernetes Gateway API and Envoy Gateway extensions, it's necessary to familiarize yourself with the underlying Envoy Gateway primitives:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"GatewayClass"})," - Defines which controller manages the Gateway. Envoy AI Gateway uses the same GatewayClass as Envoy Gateway."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Gateway"})," - The entry point for traffic. A Gateway resource defines listeners (HTTP/HTTPS ports). When you create a Gateway, Envoy Gateway deploys the actual Envoy proxy pods and a corresponding Kubernetes Service (typically a LoadBalancer). This is like a Network Load Balancer (although technically you'd still need to attach an NLB to an Envoy Gateway to accept traffic that's external the Kubernetes cluster.)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"HTTPRoute"})," - The instruction for routing traffic HTTP based on hostnames, paths, or headers. Conceptually, this is similar to ingress rules or listener rules in ALB."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Backend"})," - A Kubernetes Service or an external endpoint."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"BackendTrafficPolicy"})," - Configures connection behavior like timeouts, retries, and rate limiting of an HTTPRoute."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ClientTrafficPolicy"})," - Configures how the Envoy proxy server behaves with downstream clients."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"EnvoyExtensionPolicy"})," - A way to extend Envoy's traffic processing capabilities."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Envoy AI Gateway introduces following CRDs:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"AIGatewayRoute"})," - Defines unified API and routing rules for AI traffic"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"AIServiceBackend"})," - Represents individual AI service backends like Bedrock"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"BackendSecurityPolicy"})," - Configures authentication for backend access"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"BackendTLSPolicy"})," - Defines TLS parameters for backend connections"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"envoy.png",src:s(55210).A+"",width:"800",height:"693"})}),"\n",(0,t.jsx)(n.p,{children:"This envoy gateway blueprint deploys Envoy AI Gateway on Amazon EKS and supports two use cases:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Multi-model routing"}),"\n",(0,t.jsx)(n.li,{children:"Rate limiting"}),"\n"]}),"\n",(0,t.jsxs)(r.A,{header:(0,t.jsx)(n.h2,{children:(0,t.jsx)(n.span,{children:"Deploying the Solution"})}),children:[(0,t.jsx)(n.p,{children:"We are utilizing Terraform Infrastructure as Code (IaC) templates to deploy an Amazon EKS cluster, and we dynamically scale GPU nodes using Karpenter when the model is deployed using inference charts."}),(0,t.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),(0,t.jsx)(n.p,{children:"Before we begin, ensure you have all the necessary prerequisites in place to make the deployment process smooth. Make sure you have installed the following tools on your machine:"}),(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html",children:"aws cli"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://Kubernetes.io/docs/tasks/tools/",children:"kubectl"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://learn.hashicorp.com/tutorials/terraform/install-cli",children:"terraform"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://pypi.org/project/envsubst/",children:"envsubst"})}),"\n"]}),(0,t.jsx)(n.h3,{id:"deploy",children:"Deploy"}),(0,t.jsx)(n.p,{children:"Clone the repository"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/awslabs/ai-on-eks.git\n"})}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Important Note:"})}),(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step1"}),": Ensure that you update the region in the ",(0,t.jsx)(n.code,{children:"blueprint.tfvars"})," file before deploying the blueprint.\nAdditionally, confirm that your local region setting matches the specified region to prevent any discrepancies."]}),(0,t.jsxs)(n.p,{children:["For example, set your ",(0,t.jsx)(n.code,{children:'export AWS_DEFAULT_REGION="<REGION>"'})," to the desired region:"]}),(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Step2"}),": Run the installation script."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ai-on-eks/infra/envoy-ai-gateway/ && chmod +x install.sh\n./install.sh\n"})}),(0,t.jsx)(n.h3,{id:"verify-the-resources",children:"Verify the resources"}),(0,t.jsx)(n.p,{children:"Once the installation finishes, verify the Amazon EKS Cluster."}),(0,t.jsx)(n.p,{children:"Creates k8s config file to authenticate with EKS."}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aws eks --region us-west-2 update-kubeconfig --name envoy-gateway-cluster\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"NAME                                           STATUS   ROLES    AGE      VERSION\nip-100-64-118-130.us-west-2.compute.internal   Ready    <none>   3h9m     v1.33.5-eks-ba24e9c\nip-100-64-127-174.us-west-2.compute.internal   Ready    <none>   3h9m     v1.33.5-eks-ba24e9c\nip-100-64-132-168.us-west-2.compute.internal   Ready    <none>   3h9m     v1.33.5-eks-ba24e9c\n"})}),(0,t.jsx)(n.p,{children:"Verify the Karpenter autoscaler Nodepools"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get nodepools\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"NAME                NODECLASS           NODES   READY   AGE\ng5-gpu-karpenter    g5-gpu-karpenter    0       True    5d20h\ng6-gpu-karpenter    g6-gpu-karpenter    0       True    5d20h\ng6e-gpu-karpenter   g6e-gpu-karpenter   2       True    5d20h\ninferentia-inf2     inferentia-inf2     0       True    5d20h\ntrainium-trn1       trainium-trn1       0       True    5d20h\nx86-cpu-karpenter   x86-cpu-karpenter   1       True    5d20h\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get pod,svc,deployment -n envoy-gateway-system\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"NAME                                                          READY   STATUS    RESTARTS   AGE\npod/envoy-default-ai-gateway-27dc8f39-7595568bc8-8cxsx        3/3     Running   0          24h\npod/envoy-gateway-587c57f58f-hql9n                            1/1     Running   0          24h\n\nNAME                                             TYPE           CLUSTER-IP       EXTERNAL-IP                                                                     PORT(S)                                            AGE\nservice/envoy-gateway                            ClusterIP      172.20.166.211   <none>                                                                          18000/TCP,18001/TCP,18002/TCP,19001/TCP,9443/TCP   5d20h\n\nNAME                                                     READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/envoy-default-ai-gateway-27dc8f39        1/1     1            1           5d20h\ndeployment.apps/envoy-gateway                            1/1     1            1           5d20h\n"})})]}),"\n",(0,t.jsx)(n.h2,{id:"deploying-self-hosted-models",children:"Deploying self-hosted models"}),"\n",(0,t.jsxs)(n.p,{children:["Envoy AI gateway currently supports self-hosted models that can speak OpenAI API schema. We will deploy two models using ",(0,t.jsx)(n.a,{href:"https://github.com/awslabs/ai-on-eks-charts",children:"AI on EKS Inference Charts"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"1-create-hugging-face-token-secret",children:"1. Create Hugging Face Token Secret"}),"\n",(0,t.jsxs)(n.p,{children:["Create a Kubernetes secret with your ",(0,t.jsx)(n.a,{href:"https://huggingface.co/docs/hub/en/security-tokens",children:"Hugging Face token"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl create secret generic hf-token --from-literal=token=your_huggingface_token\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-deploy-pre-configured-models",children:"2. Deploy Pre-configured Models"}),"\n",(0,t.jsx)(n.p,{children:"Choose from the available pre-configured models and deploy:"}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["These deployments will need GPU/Neuron resources which need to\nbe ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-resource-limits.html",children:"enabled"})," and cost more than CPU only\ninstances."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Add helm chart repository\nhelm repo add ai-on-eks https://awslabs.github.io/ai-on-eks-charts/\nhelm repo update\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Model 1: Deploy qwen3 model\nhelm install qwen3-1.7b ai-on-eks/inference-charts -f https://raw.githubusercontent.com/awslabs/ai-on-eks-charts/refs/heads/main/charts/inference-charts/values-qwen3-1.7b-vllm.yaml \\\n  --set nameOverride=qwen3 \\\n  --set fullnameOverride=qwen3 \\\n  --set inference.serviceName=qwen3\n\n# Model 2: Deploy gpt oss model\nhelm install gpt-oss ai-on-eks/inference-charts -f https://raw.githubusercontent.com/awslabs/ai-on-eks-charts/refs/heads/main/charts/inference-charts/values-gpt-oss-20b-vllm.yaml \\\n  --set nameOverride=gpt-oss \\\n  --set fullnameOverride=gpt-oss \\\n  --set inference.serviceName=gpt-oss\n"})}),"\n",(0,t.jsx)(n.p,{children:"Verify models up and running"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get pod\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"NAME                       READY   STATUS    RESTARTS   AGE\ngpt-oss-67c5bcdd5c-lx9vh   1/1     Running   0          44h\nqwen3-b5fdf6bd5-cxkwd      1/1     Running   0          44h\n"})}),"\n",(0,t.jsx)(n.h3,{id:"enabling-access-to-aws-bedrock-models",children:"Enabling access to AWS Bedrock models"}),"\n",(0,t.jsxs)(n.p,{children:["Access to all Amazon Bedrock foundation models is enabled by default with the correct AWS Marketplace permissions. For more details on managing access to models in Amazon Bedrock, review ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/bedrock/latest/userguide/model-access.html",children:"Access Amazon Bedrock foundation models"})]}),"\n",(0,t.jsxs)(n.p,{children:["Review ",(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/bedrock/latest/userguide/models-supported.html",children:"Supported foundation models in Amazon Bedrock"})," for a list of foundation models available via Amazon Bedrock and relevant model information including Model ID."]}),"\n",(0,t.jsx)(n.h2,{id:"multi-model-routing",children:"Multi-model routing"}),"\n",(0,t.jsxs)(n.p,{children:["Route requests to different AI models based on the ",(0,t.jsx)(n.code,{children:"x-ai-eg-model"})," header. This header enables Envoy AI gateway to identify appropriate route configured within the gateway and routes client traffic to relevant backend kubernetes service. In this case, it's a service that exposes a self-hosted model or Amazon Bedrock model."]}),"\n",(0,t.jsx)(n.h3,{id:"deploy-common-gateway-infrastructure",children:"Deploy common gateway infrastructure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ../../blueprints/gateways/envoy-ai-gateway\nkubectl apply -f gateway.yaml\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"serviceaccount/ai-gateway-dataplane-aws created\ngatewayclass.gateway.networking.k8s.io/envoy-gateway created\nenvoyproxy.gateway.envoyproxy.io/ai-gateway created\ngateway.gateway.networking.k8s.io/ai-gateway created\nclienttrafficpolicy.gateway.envoyproxy.io/ai-gateway-buffer-limit created\n"})}),"\n",(0,t.jsx)(n.h3,{id:"configure-model-backends",children:"Configure model backends"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f model-backends.yaml\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"backend.gateway.envoyproxy.io/gpt-oss-backend created\naiservicebackend.aigateway.envoyproxy.io/gpt-oss created\nbackend.gateway.envoyproxy.io/qwen3-backend created\naiservicebackend.aigateway.envoyproxy.io/qwen3 created\nbackend.gateway.envoyproxy.io/bedrock-backend created\naiservicebackend.aigateway.envoyproxy.io/bedrock created\nbackendsecuritypolicy.aigateway.envoyproxy.io/bedrock-policy created\nbackendtlspolicy.gateway.networking.k8s.io/bedrock-tls created\n"})}),"\n",(0,t.jsx)(n.h3,{id:"configure-model-routes",children:"Configure model routes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f multi-model-routing/ai-gateway-route.yaml\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"aigatewayroute.aigateway.envoyproxy.io/multi-model-route created\n"})}),"\n",(0,t.jsx)(n.h2,{id:"test",children:"Test"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python3 multi-model-routing/client.py\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Expected Output"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\ud83d\ude80 AI Gateway Multi-Model Routing Test\n============================================================\nGateway URL: http://k8s-envoygat-envoydef-xxxxxxxxxx-xxxxxxxxxxxxxxxx.elb.us-west-2.amazonaws.com\n\n=== Testing Qwen3 1.7B ===\nStatus Code: 200\n\u2705 SUCCESS: Qwen3 - [response content]\n\n=== Testing Self-hosted GPT ===\nStatus Code: 200\n\u2705 SUCCESS: GPT - [response content]\n\n=== Testing Bedrock Claude ===\nStatus Code: 200\n\u2705 SUCCESS: Bedrock Claude - [response content]\n\n\ud83c\udfaf Final Results:\n\u2022 Qwen3 1.7B: \u2705 PASS\n\u2022 GPT OSS 20B: \u2705 PASS\n\u2022 Bedrock Claude: \u2705 PASS\n\n\ud83d\udcca Summary: 3/3 models working\n"})}),"\n",(0,t.jsx)(n.h2,{id:"rate-limiting",children:"Rate limiting"}),"\n",(0,t.jsx)(n.p,{children:"Token-based rate limiting with automatic tracking for AI workloads."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Features"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Token-based rate limiting (input, output, and total tokens)"}),"\n",(0,t.jsxs)(n.li,{children:["User-based rate limiting using ",(0,t.jsx)(n.code,{children:"x-user-id"})," header"]}),"\n",(0,t.jsx)(n.li,{children:"Redis backend for distributed rate limiting (automatically deployed)"}),"\n",(0,t.jsx)(n.li,{children:"Configurable limits per user per time window"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"configure-rate-limiting",children:"Configure rate limiting"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f rate-limiting/ai-gateway-route.yaml\nkubectl apply -f rate-limiting/ai-gateway-rate-limit.yaml\nkubectl apply -f rate-limiting/backend-traffic-policy.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"test-rate-limiting",children:"Test rate limiting"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python3 rate-limiting/client.py\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration-details",children:"Configuration Details"}),"\n",(0,t.jsx)(n.h3,{id:"routing-configuration",children:"Routing Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["The AI Gateway routes requests based on the ",(0,t.jsx)(n.code,{children:"x-ai-eg-model"})," header:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Header Value"}),(0,t.jsx)(n.th,{children:"Backend"}),(0,t.jsx)(n.th,{children:"Endpoint"}),(0,t.jsx)(n.th,{children:"Model Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Qwen/Qwen3-1.7B"})}),(0,t.jsx)(n.td,{children:"qwen3"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/v1/chat/completions"})}),(0,t.jsx)(n.td,{children:"Self-hosted"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"openai/gpt-oss-20b"})}),(0,t.jsx)(n.td,{children:"gpt-oss"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/v1/chat/completions"})}),(0,t.jsx)(n.td,{children:"Self-hosted"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"anthropic.claude-3-haiku-20240307-v1:0"})}),(0,t.jsx)(n.td,{children:"bedrock"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/anthropic/v1/messages"})}),(0,t.jsx)(n.td,{children:"AWS Bedrock"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"bedrock-integration-details",children:"Bedrock Integration Details"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authentication"}),": Pod Identity (automatically configured via installation script)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Schema"}),": AWSAnthropic for native Bedrock support"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Endpoint"}),": ",(0,t.jsx)(n.code,{children:"/anthropic/v1/messages"})," (Anthropic Messages API format)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Region"}),": Configurable in ",(0,t.jsx)(n.code,{children:"backend-security-policy.yaml"})," (default: us-west-2)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/envoyproxy/ai-gateway",children:"Envoy AI Gateway Documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://gateway.envoyproxy.io/",children:"Envoy Gateway Documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.aws.amazon.com/bedrock/",children:"AWS Bedrock Documentation"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Multi-Model Routing"}),": Requires deployed AI model services and AWS Bedrock access"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate Limiting"}),": Requires actual AI models that return real token usage data and Redis for storage"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bedrock Integration"}),": Requires AWS Bedrock API access, proper IAM setup, and Pod Identity configuration"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authentication"}),": Pod Identity for Bedrock is automatically configured when deploying via the installation script"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"These are working configuration examples that demonstrate AI Gateway capabilities with real AI model deployments and AWS Bedrock integration."})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);